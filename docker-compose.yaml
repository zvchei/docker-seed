x-args: &args
    USER: user
    REPOSITORY: project

x-git-args: &git-args
    GIT_AUTHOR_NAME: author
    GIT_AUTHOR_EMAIL: email@example.com

x-base: &base
    volumes:
        - storage:/home/${USER}/${REPOSITORY}
    cap_drop:
        - all
    security_opt:
        - no-new-privileges

services:      
    git:
        <<: *base
        build:
            context: .
            dockerfile: git.dockerfile
            args:
                <<: [*args, *git-args]

volumes:
    storage:
